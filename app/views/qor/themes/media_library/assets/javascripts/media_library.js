"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?e(require("jquery")):e(jQuery)}(function(f){var r="qor.medialibrary.action",e="enable."+r,t="keyup."+r,i="switched.qor.tabbar.radio",o='[data-toggle="qor.tab.radio"]',l='[data-tab-source="video_link"]',s=".qor-video__link",a=".qor-medialibrary__video-link",n=".qor-medialibrary__video",c=".qor-medialibrary__desc",u=".qor-file__options",d=".qor-bottomsheets__mediabox";function m(e){var t=e.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/);return!(!t||11!=t[7].length)&&t[7]}function h(e){var t=e.match(/(\/id_)(\w+)/);return!!(/http?:\/\/(www\.)|(v\.)youku.com/.test(e)&&t&&t[2])&&t[2]}function b(e,t){this.$element=f(e),this.options=f.extend({},b.DEFAULTS,f.isPlainObject(t)&&t),this.init()}return b.prototype={constructor:b,init:function(){this.bind(),this.initMedia()},bind:function(){f(document).on(i,o,this.resetMediaData.bind(this)).on(t,s,this.setVideo.bind(this)).on(t,c,this.setImageDesc.bind(this)).on("reload.qor.bottomsheets",d,this.initMedia.bind(this,"bottomsheet"))},unbind:function(){f(document).off(i,o,this.resetMediaData.bind(this)).off(t,s,this.setVideo.bind(this)).off(t,c,this.setImageDesc.bind(this))},setMediaData:function(e,t){var i=e.find(u),o=e.find('input[name="QorResource.MediaOption"]');i.val(JSON.stringify(t)),o.val(JSON.stringify(t))},setImageDesc:function(e){var t,i,o=f(e.target),r=o.closest("form");t=r.find(u),(i=JSON.parse(t.val())).Description=o.val(),this.setMediaData(r,i)},initMedia:function(e){var t=f(n),i=f(a);e&&(t=f(d).find(n),i=f(d).find(a)),f(d).find(".qor-table--medialibrary-file").each(function(){f(this).closest(".mdl-card__supporting-text").addClass("qor-table--files")}),(t.length||i.length)&&(t.each(function(){var e=f(this),t=e.data("videolink");t&&t.match(/\.mp4$|\.m4p$|\.m4v$|\.m4v$|\.mov$|\.mpeg$|\.webm$|\.avi$|\.ogg$|\.ogv$/)&&e.parent().addClass("qor-table--video qor-table--video-internal").html('<video width=100% height=100% controls><source src="'+t+'"></video>')}),i.each(function(){var e=f(this),t=e.data("videolink"),i=m(t),o=h(t);i&&e.parent().addClass("qor-table--video qor-table--video-external").html('<iframe width="100%" height="100%" src="//www.youtube.com/embed/'+i+'?rel=0" frameborder="0" allowfullscreen></iframe>'),o&&e.parent().addClass("qor-table--video qor-table--video-external").html('<iframe width=100% height=100% src="http://player.youku.com/embed/'+o+'" frameborder=0 "allowfullscreen"></iframe>')}))},setVideo:function(e){var t=f(e.target),i=t.closest("[data-tab-source]"),o=t.closest("form"),r=o.find(u),a=JSON.parse(r.val()),n=t.val(),d=i.find("iframe"),l=m(n),s=h(n);a.SelectedType="video_link",a.Video=n,a.Description=i.find(c).val(),this.setMediaData(o,a),(l||s)&&(d.length&&d.remove(),l&&i.append('<iframe width="100%" height="400" src="//www.youtube.com/embed/'+l+'?rel=0" frameborder="0" allowfullscreen></iframe>'),s&&i.append('<iframe width=100% height=400 src="http://player.youku.com/embed/'+s+'" frameborder=0 "allowfullscreen"></iframe>'))},resetMediaData:function(e,t,i){var o=f(t),r=o.closest("form"),a=o.find(u),n=o.find(l).find(".qor-fieldset__alert"),d=JSON.parse(a.val());"video_link"==(d.SelectedType=i)&&(d.Video=o.find(s).val(),n.length&&n.remove()),d.Description=f('[data-tab-source="'+i+'"]').find(c).val(),f('[name="QorResource.SelectedType"]').val(i),this.setMediaData(r,d)},destroy:function(){this.unbind()}},b.DEFAULTS={},f.fn.qorSliderAfterShow=f.fn.qorSliderAfterShow||{},f.fn.qorSliderAfterShow.renderMediaVideo=function(){var e=f(l),t=f(c),i=e.length&&e.data().videourl,o=i&&m(i),r=i&&h(i);t.length&&t.val(t.data().imageInfo.Description),e.length&&i&&(o&&e.append('<iframe width="100%" height="400" src="//www.youtube.com/embed/'+o+'?rel=0&fs=0&modestbranding=1&disablekb=1" frameborder="0" allowfullscreen></iframe>'),r&&e.append('<iframe width=100% height=400 src="http://player.youku.com/embed/'+r+'" frameborder=0 "allowfullscreen"></iframe>'))},b.plugin=function(o){return this.each(function(){var e,t=f(this),i=t.data(r);if(!i){if(/destroy/.test(o))return;t.data(r,i=new b(this,o))}"string"==typeof o&&f.isFunction(e=i[o])&&e.apply(i)})},f(function(){var t=".qor-table--medialibrary";f(document).on("disable.qor.medialibrary.action",function(e){b.plugin.call(f(t,e.target),"destroy")}).on(e,function(e){b.plugin.call(f(t,e.target))}).triggerHandler(e)}),b});